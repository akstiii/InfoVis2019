<html>
  <head>
    <title>InfoVis2019: Final task</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="custom.css">
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body style="font-family: "Times New Roman", Times, serif;">
    <div class="container">
      <h1 class="text-center">Final Task</h1>
      <h2>Isosurfaces</h2>
      <div class="row">
        <div>
          <div class="col-12 col-sm-6 col-md-4 float-right">
            <div id="display1"></div>
            <div id="controller1">
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text">Isovalue</span>
                </div>
                <input id="isovalue1" type="range" class="form-control custom-range" min="0" max="255" value="128"/>
                <span id="isovalue1S" class="input-group-text"></span>
              </div>
            </div>
          </div>
          <p class="text-justify">
            For visualizing Isosurface extracted from volume data I used Marching Cubes algorithm implemented which was implemented during class. In first canvas is barebone Isosurface extracted from Lobster data without any shading effects. Iso value can be adjusted by the slider, which works as threshold value for mesh construction. Values greater than iso value are included and others not, hence setting value too high will make details disappear and too low will also include some noise in the data to the mesh.
          </p>
        </div>
      </div>
      <div class="row">
        <div>
          <div class="col-12 col-sm-6 col-md-4 float-right">
            <div id="display3"></div>
            <div id="controller3">
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text" style="width: 10ch">Point.X</span>
                </div>
                <input id="X3" type="range" class="form-control custom-range" value="0"/>
                <span id="X3s" class="input-group-text" style="width: 5ch"></span>
              </div>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text" style="width: 10ch">Point.Y</span>
                </div>
                <input id="Y3" type="range" class="form-control custom-range" value="0" data-toggle="tooltip" data-placement="top"/>
                <span id="Y3s" class="input-group-text" style="width: 5ch"></span>
              </div>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text" style="width: 10ch">Point.Z</span>
                </div>
                <input id="Z3" type="range" class="form-control custom-range" value="12" data-toggle="tooltip" data-placement="top"/>
                <span id="Z3s" class="input-group-text" style="width: 5ch"></span>
              </div>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text" style="width: 10ch">Normal.X</span>
                </div>
                <input id="nX3" type="range" class="form-control custom-range" step="0.1" value="0" data-toggle="tooltip" data-placement="top"/>
                <span id="nX3s" class="input-group-text" style="width: 5ch"></span>
              </div>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text" style="width: 10ch">Normal.Y</span>
                </div>
                <input id="nY3" type="range" class="form-control custom-range" step="0.1" value="0" data-toggle="tooltip" data-placement="top"/>
                <span id="nY3s" class="input-group-text" style="width: 5ch"></span>
              </div>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text" style="width: 10ch">Normal.Z</span>
                </div>
                <input id="nZ3" type="range" class="form-control custom-range" step="0.1" value="1" data-toggle="tooltip" data-placement="top"/>
                <span id="nZ3s" class="input-group-text" style="width: 5ch"></span>
              </div>
              <button id="applyCoords3" type="button" class="btn btn-primary">Apply</button>
            </div>
          </div>
          <p class="text-justify">
            For the next canvas I have modified the Isosurface implementation to extract slice planes. By adjusting Point and Normal parameter one can control point and angle (direction) where volume is sliced.
          </p>
        </div>
      </div>

      <h2>Volume rendering</h2>
      <div class="row">
        <div>
          <div class="col-12 col-sm-6 col-md-4 float-right">
            <div id="display2"></div>
            <div id="controller2">
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text">Isovalue</span>
                </div>
                <input id="isovalue2" type="range" class="form-control custom-range" min="0" max="255" value="128"/>
                <span id="isovalue2S" class="input-group-text"></span>
              </div>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text">Material</span>
                </div>
                <select id="material2" class="form-control">
                  <option value="Basic">Basic</option>
                  <option value="Lambert" selected="selected">Lambert</option>
                  <option value="Phong">Phong</option>
                </select>
              </div>
            </div>
          </div>
          <p class="text-justify">
          With shading effects one can simulate lighting and reflection, to be able see the details of the surface these are necessary. I decided to use THREE.js packed Shaders: Basic, Lambert and Phong which can select via dropdown.
          </p>
        </div>
      </div>

      <h2>Streamline</h2>
      <div class="row">
        <div>
          <div class="col-12 col-sm-6 col-md-4 float-right">
            <div id="display4"></div>
            <div id="controller4">
            </div>
          </div>
          <div class="col-12 col-sm-6 col-md-4 float-right">
            <div id="display6"></div>
            <div id="controller6">
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text" style="width: 10ch">X</span>
                </div>
                <input id="X6" type="range" class="form-control custom-range" value="0"/>
                <span id="X6s" class="input-group-text" style="width: 5ch"></span>
              </div>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text" style="width: 10ch">Y</span>
                </div>
                <input id="Y6" type="range" class="form-control custom-range" value="0" data-toggle="tooltip" data-placement="top"/>
                <span id="Y6s" class="input-group-text" style="width: 5ch"></span>
              </div>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text" style="width: 10ch">Z</span>
                </div>
                <input id="Z6" type="range" class="form-control custom-range" value="12" data-toggle="tooltip" data-placement="top"/>
                <span id="Z6s" class="input-group-text" style="width: 5ch"></span>
              </div>
              <button id="addPoint6" type="button" class="btn btn-primary">Add point</button>
              <button id="removePoints6" type="button" class="btn btn-primary">Remove points</button>
              <button id="seedPoints6" type="button" class="btn btn-primary">Reseed</button>
            </div>
          </div>
          <p class="text-justify">
            Streamlines are lines that describe the fluid flow and the data used to draw streamlines are vector fields that describe the movement at certain point in 2D/3D space. For streamlines I used RungeKutta4 integrator, 1500 steps and 0.6 step length. The integration is done first Forward and then Backward. For default seeds I used 38 points along Z axis, at center of X and Y axes. On the first canvas one can see the seed points used the create the streamlines on the other canvas. Adjusting X, Y, Z one can move the red point in the first canvas and add it as seed for streamline visualization.  One must apply seeds separately via “Reseed” as rendering the lines is quiet heavy operation at least with current settings.
            I also investigated more sophisticated seeding algorithms. Such as “Farthest Point Seeding”, which uses Delaunay triangles for approximating possible seed points along initial streamline. However, I didn’t have time to implement it and most of the papers on seeding algorithms were in 3D space.
          </p>
        </div>
      </div>

      <h2>Summary</h2>
      <div class="row">
        I ended up using too much time on the visual aspects of report and optimizing the canvas rendering as the page got heavy with only few WebGLContexts. I managed to do the rendering of all canvas with only one context, but the page is still quite heavy.
      </div>

    </div>

    <script src="three.min.js"></script>
    <script src="TrackballControls.js"></script>
    <script src="https://naohisas.github.io/KVS.js/Build/KVS.min.js"></script>
    <!--script src="https://naohisas.github.io/KVS.js/Build/KVS2THREE.min.js"></script-->
    <!--script src="KVS2THREE.js"></script-->
    <script src="KVS2THREE.min.js"></script>
    <script src="MultiSceneCanvas.js"></script>
    <script src="https://naohisas.github.io/KVS.js/Source/KVSLobsterData.js"></script>
  	<script src="../Lut_old.js"></script>
    <script src="Bounds.js"></script>
  	<script src="Isosurfaces.js"></script>
  	<script src="Slice.js"></script>
  	<script src="Streamline.js"></script>
  	<script src="Arrows.js"></script>
    <script src="main.js"></script>
    <script>
      main();
    </script>
    <script>
      $(document).ready(function() {
        $(".form-control,.custom-range").on("input", function() {
          var value = $(this).val();
          $(this).next().html(value);
        });
        $(".form-control,.custom-range").each(function(i, obj) {
          var value = $(this).val();
          $(this).next().html(value);
        });
        $('[data-toggle="tooltip"]').tooltip();
      });
    </script>
  </body>
</html>
